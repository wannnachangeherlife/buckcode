# Conversation Archive

- Date: 2025-11-27
- Workspace: buckcode (local); CI repo: wannnachangeherlife/Heritage-Learning-System
- Context: Windows + PowerShell 5.1; Python venv 3.13.9

## Overview
- Goal: 两年内完成文化遗产数字化学习系统与竞赛准备，集成 Notion、Obsidian、GitHub、邮件、AI 与自动化。
- Outcome: 落地自动化脚本与 GitHub Actions；修复 Notion 关系、同步、邮件与 Windows 编码；补充健康检查与文档。

## Key Milestones
- 规划路线图与周计划；设计多工具联动（Notion/Obsidian/GitHub/邮件/AI）。
- Notion 架构：先建库，后更新为双向关系（dual_property + synced_property_name）。
- 修复 Notion→Obsidian 同步：数据库 ID 回退、属性名与解析、DRY_RUN、安全文件命名。
- 核心脚本完善：空日期健壮性、SMTP 可配、Windows UTF-8 日志。
- GitHub Actions：定时工作流 + 健康检查工作流；Secrets 规范（避免 GITHUB_ 前缀，使用 GH_TOKEN/GH_REPO）。
- 本地健康检查脚本：汇总缺失 Secrets 与外部连通性。

## Files Touched (recent)
- .github/workflows/health_check.yml（新增，运行本地/远端健康检查）
- automation_scripts/secrets_check.py（新增，检查 Secrets 与连通性）
- README.md（新增 Actions 使用方法、Secrets 列表与排错）
- 既有脚本（历史变更）：
  - automation_scripts/fill_notion_relations.py（双向关系）
  - automation_scripts/notion_to_obsidian_sync.py（ID 回退、属性修正、DRY_RUN）
  - automation_scripts/learning_system_core.py（SMTP/日志/空值健壮）
  - 其他 demo/导入/诊断脚本等

## Workflows
- Health Check：手动触发，输出 JSON 报告，缺失/无效配置将置红（exit code 1）。
- Periodic Learning Tasks：定时与手动；执行 Notion↔GitHub 同步、邮件、分析等。

## Required Secrets (Repository Secrets)
- NOTION_API_KEY, NOTION_DATABASE_ID
- GH_TOKEN, GH_REPO（示例：wannnachangeherlife/Heritage-Learning-System）
- AI_API_KEY, AI_BASE_URL（例：https://api.deepseek.com）, AI_MODEL（例：deepseek-chat）
- EMAIL_USER, EMAIL_PASSWORD（应用专用密码）, EMAIL_SMTP_SERVER（例：smtp.mail.me.com / smtp.gmail.com）, EMAIL_SMTP_PORT（587）

## Local Check (Optional)
```powershell
$env:NOTION_API_KEY="..."
$env:NOTION_DATABASE_ID="..."
$env:GH_TOKEN="..."
$env:GH_REPO="wannnachangeherlife/Heritage-Learning-System"
$env:AI_API_KEY="..."; $env:AI_BASE_URL="https://api.deepseek.com"; $env:AI_MODEL="deepseek-chat"
$env:EMAIL_USER="you@example.com"; $env:EMAIL_PASSWORD="app-specific-password"
$env:EMAIL_SMTP_SERVER="smtp.example.com"; $env:EMAIL_SMTP_PORT="587"
D:/Administrator/Documents/magicalgitzone/venv/Scripts/python.exe automation_scripts/secrets_check.py
```

## Next Steps
- 在目标仓库添加 11 个 Secrets；先运行 Health Check，后运行 Periodic Learning Tasks。
- 如失败，将 Actions 运行日志或 JSON 报告回传以便快速修复。
